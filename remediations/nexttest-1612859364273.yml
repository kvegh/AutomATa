---
# Red Hat Insights has recommended one or more actions for you, a system administrator, to review and if you
# deem appropriate, deploy on your systems running Red Hat software. Based on the analysis, we have automatically
# generated an Ansible Playbook for you. Please review and test the recommended actions and the Playbook as
# they may contain configuration changes, updates, reboots and/or other changes to your systems. Red Hat is not
# responsible for any adverse outcomes related to these recommendations or Playbooks.
#
# nexttest
# https://cloud.redhat.com/insights/remediations/b8880b28-e7cf-406a-8bf9-2bbde9bdf388
# Generated by Red Hat Insights on Tue, 09 Feb 2021 08:29:24 GMT
# Created by kvegh@redhat.com

# Decreased security: OpenSSH ClientAlive settings
# Identifier: (advisor:hardening_ssh_client_alive|OPENSSH_HARDENING_CLIENT_ALIVE,fix)
# Version: c988b9061f0c3720900ae391d72a59a89bf57294
- name: Set ClientMaxAlive and ClientAliveInterval. Restart sshd service.
  hosts: rhel-kvegh-demo4-741.kveghdemo.at
  become: true
  tasks:
    - name: Update ClientAliveInterval setting
      lineinfile:
        dest: /etc/ssh/sshd_config
        backup: true
        regexp: (?i)^\s*ClientAliveInterval\s+[0-9]+
        line: ClientAliveInterval 300

    - name: Update ClientMaxAlive setting
      lineinfile:
        dest: /etc/ssh/sshd_config
        backup: true
        regexp: (?i)^\s*ClientAliveCountMax\s+[0-9]+
        line: ClientAliveCountMax 0

    - name: restart sshd service
      service:
        name: sshd
        state: restarted

- name: run insights
  hosts: rhel-kvegh-demo4-741.kveghdemo.at
  vars:
    insights_signature_exclude: /hosts
  become: true
  gather_facts: false
  tasks:
    - name: run insights
      command: insights-client
      changed_when: false
