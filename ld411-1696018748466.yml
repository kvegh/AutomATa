---
# Red Hat Insights has recommended one or more actions for you, a system administrator, to review and if you
# deem appropriate, deploy on your systems running Red Hat software. Based on the analysis, we have automatically
# generated an Ansible Playbook for you. Please review and test the recommended actions and the Playbook as
# they may contain configuration changes, updates, reboots and/or other changes to your systems. Red Hat is not
# responsible for any adverse outcomes related to these recommendations or Playbooks.
#
# ld411
# https://console.redhat.com/insights/remediations/785d3cd7-a2a0-4f47-9ade-e376ddd7086a
# Generated by Red Hat Insights on Fri, 29 Sep 2023 20:19:08 GMT
# Created by kvegh@redhat.com

- name: run insights to obtain latest diagnosis info
  hosts: "rhel-kvegh-web25-711.kveghdemo.at,rhel-kvegh-web25-741.kveghdemo.at,rhel-kvegh-web25-801.kveghdemo.at"
  vars:
    insights_remediation: " 785d3cd7-a2a0-4f47-9ade-e376ddd7086a"
    insights_signature_exclude: "/hosts,/vars/insights_signature,/vars/insights_remediation"
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldVaHBRblZqZG5jMU9FUXJhalZ3VGtGUmFtRkdVa0ZCYTBSVWNu
      UnZRVzFSVkRBdlFVODVaRlJyYlRablJHZHRabUkyVGxGMGFVNEtPWHBNYmtWcmRsaEpibVZQV2s0
      MWRGcDBPSEZWWmtaaFNYQnBSMEV5SzFGWU9GVlNaR2hWTDJOdmRIbDRLMWQ2UlZscU1sSlpaSEEz
      ZEVnM01IQXpWUXBpWjFwbVRGRTNkV2wxYm5NNGIwMXFaV3N5VURaVFVWcExXRmxhV1c0NVYyZENP
      V2R2VG5FMk9FZERXbXR3Um1KVFVqWXJTRVl3TWxwYVVUUlZTV0ZtQ21Ga05XSmplWElyZVVwbFoy
      TlFVVk5RYUhscmNtaGtaV1pQWm5ORk9YUlhlVmhXUjFwSk1ETnNXSGh3VEVaSlJsQlFZWFZRUzNB
      NE5WcHBha0Y0VjNvS2RHYzRTSGRGUjJzME5HRTFRa3BqYVdsdWQyNXJWV1pDVEc0NFVHeHVPRVF2
      TjNSc1NsZExUVWh4TmtsWVkwMW1NVzlVU1RKdWMzZDFXRkZzTUhsbWRRcHNUekYwVHpkWFpHVTJO
      QzlHT0dGdVptNVpUVUZ5TjNoamIxTTJaMU5sTDJWeWRuVnZOamt3YVVOWFYyWm5SV294WVhSd1Qx
      cDJjazF5YmxkSllYUlhDakZrYUVONFVqaGFabkE1UmxsQ2RXUnhZV05yYVhGWVNtNDBjbEppTTFo
      clFVWlNUVmQ0YTBseWJFVkdkRUZKYjJveVdrNDJabGRVYjJwQ1JVTmlRbmNLZG14RmQxWmxObGhR
      ZW5WYWVVRm9Sa0ZFZGxWcU1UZElLME01VnpCd1ZrcHlkM3BSVUV0cE1DOXJlRTFOZVV0UWJ6ZDNa
      R3BEU0dsalFtdHRRVk01TXdwR1ZYbzVUMWcxY0RRNFpIa3lhV1p6TDBOblIyMW5XWFZEWjI1UllW
      QjNWMkpHTUhkMGREQmlWVk55WldkUldWZ3JkV3hJTlhOQlJtMW9TVUZ1Ym1GdENsTkNWVUV5ZFZr
      MVpsZGlPVXhzTmpablIwcGlUSGxNY1ZSUVNFcFNTbWxXWjNKTEt6VnpTMHgyZDNnMmNqTXJjVnBr
      YTFoUVIza3hSM0ZTVlZKT1NGUUtXWFoxVm5sUGRIZHZVV2xCUm1rdlJYWmxPV05xV2xwdWEwcDVW
      MlZUV1RodVVtNDFlbll5TkhSUWJGSkdVVk5xZWtscWMxSlNhVVJvYzA1UWFGUlRhd3AxZGxkYVdI
      SjBWVlpoUlQwS1BVMDNMek1LTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==
  become: true
  tasks:
    - name: obtain diagnosis info
      command: "insights-client --diagnosis{{ insights_remediation | regex_search('\\s[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}') }}"
      register: insights_result
      changed_when: false
      check_mode: false
    - name: register insights report as fact for use by other plays
      set_fact: insights_report={{ insights_result.stdout }}

# Decreased security: System log permissions
# Identifier: (advisor:hardening_logging_log_perms|HARDENING_LOGGING_3_LOG_PERMS,default_perms)
# Version: 9788a2d4ce207e3a7d0208e1627e79969b1f052f
- name: Fix hardening_logging_log_perms issue
  hosts: "rhel-kvegh-web25-711.kveghdemo.at"
  become: true
  vars:
    pydata: '{{ insights_report.details["hardening_logging_log_perms|HARDENING_LOGGING_3_LOG_PERMS"] }}'
    perms:
      "/var/log": {owner: "root", group: "root", mode: "u=rw,o-w"}
      "/var/log/wtmp": {owner: "root", group: "utmp", mode: "u=rw,g-x,o-wx"}
      "/var/log/btmp": {owner: "root", group: "utmp", mode: "u=rw,g-rwx,o-rwx"}
      "/var/log/audit": {owner: "root", group: "root", mode: "u=rw,o-rwx"}
      "/var/log/boot.log": {owner: "root", group: "root", mode: "u=rw,g-x,o-wx"}
      "/var/log/dmesg": {owner: "root", group: "root", mode: "u=rw,g-x,o-wx"}
      "/var/log/lastlog": {owner: "root", group: "utmp", mode: "u=rw,g-x,o-wx"}
      "/var/log/messages": {owner: "root", group: "root", mode: "u=rw,g-x,o-wx"}
      "/var/log/spooler": {owner: "root", group: "root", mode: "u=rw,g-x,o-wx"}
      "/var/log/tallylog": {owner: "root", group: "root", mode: "u=rw,g-x,o-wx"}
      "/var/log/yum.log": {owner: "root", group: "root", mode: "u=rw,g-x,o-wx"}
      "/var/log/cron": {owner: "root", group: "root", mode: "u=rw,g-x,o-rwx"}
      "/var/log/maillog": {owner: "root", group: "root", mode: "u=rw,g-x,o-rwx"}
      "/var/log/secure": {owner: "root", group: "root", mode: "u=rw,g-x,o-rwx"}
    insights_signature_exclude: /hosts,/vars/insights_signature,/vars/pydata
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldVc3dWRkZ6ZG5jMU9FUXJhalZ3VGtGUmFrNVZlRUZCWjBvelRr
      Y3ZNekZwV2xKNlZFTlVNMFF4VlRNNE0xQkxVM05VZUZwNk5uVUtaMVZWV1dsaWNHdHBaMHB4VkVz
      MFNsbzJTWFkxVTJ0MmVUQmFWRll3VlRWYU9FdHNXazFPYTFvd1NIbDZiMHhxYzFGcVdETTRVVGxh
      YkhoVVFYTmhXUW95Wkc5eVRHUkpURTVzUlhWaE9VVmpXV041TkdwUU9XcHVRVU5SVjNCQmNtNTFk
      a294TVd4MldXazFVa055TWxvMVNtOTNVMVJSV2xoS2FqTXdXbk41Q2tGSWNqVTRLMFpEY2xGR2JX
      eFdWbGhGVnk5M1VqSTVTakp4U2pKRFVVNDRaMVl6UkUxcUsyTkxiMUp1WVZOa2FqWnpkbUpFZEhC
      ek5YVlZRME5NU0dVS1RGRjNSbmxsYjNjeVJuUkJkbUU0UzBsV2JFNUZjRkpOWVVSalVHMW1UVGw0
      Um5oa1luTTBlR3AyVEVGdFZIWnFaemxOZG1WWU9HSjVWM1Z1VUZjeldncFlaMVk0YTJOWlkwOVla
      aTlxU1VFNUt6UlllbEJCVDNaQlp6RnpTV0ZsWWxkNlIyNTRSa0Y1WWt0bmNIQlhjSGR1YWtaaWFX
      NTRURVJwUnpCYWEzQkpDbU42TUdjMWFWRjBNVWRCYnpOVFVreHdSMUIyT0hoWVpYWjNTekpYTDFW
      R01VcGpNMjVzY0VkclpYWlljVXB6YzFKSU1YQkZhRlkyZVdwMVJXOXJhRklLV25CTFVFdENVWFpL
      TkRaSGJVY3pSM1JNZHpJelptRmtUMWR6UmpNeWJIUlRhSGtyVjA1TVJsWnRjelFyVkZaaVlVcG5N
      SGhZTjJsUU5DOXlkVkJrWXdwV1ptdEVXRVk0T0cxMFYwczBNMWRKZWxsTWNtUlBWWFZEZVRSVWVq
      TkdPV2hQV0ROdU5sbG5Va2RNTVhsTFZHcG9UbGsxTldwSk1sWnpRVFZ0Y0ZaR0NuSndLMnh0VG05
      eFZFdGlPVFZsTVhKU1FYZHlNSGxPZW5oeFZXbGxXazFhVjBGdWNtRlFUMkpHT1M5Q1lsRnFaRGxT
      VTJZNFNtMWxXV2QzU25KdlNsb0tVRWQxUTJWU1IxSkljbGQ0YTBGWmRFbHNhbU5CSzBoalFVZFpV
      MHRoVlhWdVNHc3ZUblp3TWpWTVpqaDNiMjF6VEdNMlJXRlFNbnAzVEVaaFpFSTRkUXBQZFZVMkwx
      aHRXR2RPT0QwS1BXRTJWVmdLTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==


  tasks:
    - when: insights_report.details["hardening_logging_log_perms|HARDENING_LOGGING_3_LOG_PERMS"] is defined
      block:
        - name: Set the correct permissions on affected log files
          file:
            path: "{{ item.log_perms_dirfilename }}"
            owner: "{{ perms[item.log_perms_dirfilename]['owner'] }}"
            group: "{{ perms[item.log_perms_dirfilename]['group'] }}"
            mode: "{{ perms[item.log_perms_dirfilename]['mode'] }}"
          with_items: "{{ pydata.detected_problem_log_perms }}"


# Decreased security: OpenSSH ClientAlive settings
# Identifier: (advisor:hardening_ssh_client_alive|OPENSSH_HARDENING_CLIENT_ALIVE,fix)
# Version: 9788a2d4ce207e3a7d0208e1627e79969b1f052f
- name: Set ClientMaxAlive and ClientAliveInterval. Restart sshd service.
  hosts: "rhel-kvegh-web25-711.kveghdemo.at,rhel-kvegh-web25-741.kveghdemo.at,rhel-kvegh-web25-801.kveghdemo.at"
  become: yes
  vars:
    insights_signature_exclude: /hosts,/vars/insights_signature
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldVc3hUV2ROZG5jMU9FUXJhalZ3VGtGUmFYaEplRUZCYkZOYWFU
      UmlkMWQyTTNrM1ZHOHhja04yUmtacE5GcGhSMmhXY1hOdFFrWUtNaTg1UW1WR1pVcFZRVmhYTm5o
      dGIyazJjMlZ4TVRaUmJYcE9RMFZuVVc1SVNGTlpkM0pPTlVVelNWZFVOVXRLWmxGbVFXSlhSVWR4
      UlRGM1oxVjRXQXB1ZVhkNWMwRklkbk5pYkhkb05WVTBlVUZDVFdnMmF6SjJObk4xV1dGSmRrWnpk
      VE0wVldwaWNGQkJkVlYwTmtObmFtUjJia3B4YVhCcWRtdzFUWFF4Q2pWRFRUSlNPRWRuTmxCMU5u
      bHdhVWRaTVhsTWFHWm5hMlpGV25ScGIyRTBMelI2TVhGNU5FNUlTMGxxYVM4d1RXWkJRbE1yTUV3
      dk5XazRNVlp1YmxNS1dVNVZSM0pWVVNzNVprNVZUMmh0TWxOSk1sY3JRbGhLUlN0dGFsUjFRVm8y
      VEhac1JYaEVSbVIyU0c4NWRFbG9aMjQ1UVV0aFN6SmlPVTFrZG1NclN3cHpkMDF6WjJwamRGbHhO
      MnRzWmtrelQxRm9aak4wVlVWM1ZEZEliVGxqTVdRNE1ESndlak56YUZGSVZpdG9XRmRTY0RocE1t
      VkRkR2xOYzB4VEszVTFDbVl5Y1hJMFQyNVdWMDFaUkdwNVNrSnRjR1ZLTkVGa1RrTlVPVFpNVG10
      SGJ6WkxSRVpIWWk5TFRHVjRjM0ZVT0hGSWEyVlJOMEU0YmpoSU5uZFVSMHNLT0hWMmFFOXRSVk5u
      WW1ZMFVUWmtNRTlZZUVab1JrNVBiMjV6T0ZGMFRFZDZZVGt3Vm1kRVlscHNiRFJRTXpOb1kxWnpi
      eTl2V2xSVmRYUTNVRFJ6TlFvdmRVUXdjbU0xZVdSc2RtNDRSVE13UmsxR1JVRmxabWhRWmpsdFIz
      TllTM0F2TUZoT05rTlVXVzFsY0dadk1GbEJkWHBtZUVwa1NDdFdTeXRoVVVzekNpOUZkMmd4Y1Ro
      cVNrMVlhRzFPV0RScVFYaFRNMk5uY0VoclZtcFJNSEZ5ZVRObGFHUm9kMGN5SzNsVllqZ3hNbXRK
      U2pGSU5EWlJNV3BaVUZkNWRXd0tWRXgxYzJkMVdsb3ZjRzUxVUN0eVEwbE9ibWMyVFdSTmJFRTVX
      alJuWVZrek4xTjJlVWhwY2toVmNUTkpUVzk0VTNZeVRqUlpVbmRHVjJ0SU1WQmxSZ3BxZFc1b1Rq
      ZExPWEJCUVQwS1BVeHVlSG9LTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==
  tasks:
    - name: Update ClientAliveInterval setting
      lineinfile:
        dest: /etc/ssh/sshd_config
        backup: yes
        regexp: '(?i)^\s*ClientAliveInterval\s+[0-9]+'
        line: 'ClientAliveInterval 300'

    - name: Update ClientMaxAlive setting
      lineinfile:
        dest: /etc/ssh/sshd_config
        backup: yes
        regexp: '(?i)^\s*ClientAliveCountMax\s+[0-9]+'
        line: 'ClientAliveCountMax 0'

    - name: restart sshd service
      service:
        name: sshd
        state: restarted


# Decreased security: OpenSSH Ciphers and MACs settings
# Identifier: (advisor:hardening_ssh_hmac_cipher|OPENSSH_HARDENING_HMAC_CIPHER_2,fix)
# Version: 9788a2d4ce207e3a7d0208e1627e79969b1f052f
- name: Update openssh-server package, replace Ciphers and MACs line in /etc/ssh/sshd_config and restart sshd service
  hosts: "rhel-kvegh-web25-711.kveghdemo.at"
  become: true
  vars:
    pydata: "{{ insights_report.details['hardening_ssh_hmac_cipher|OPENSSH_HARDENING_HMAC_CIPHER_2'] | default('') }}"
    insights_signature_exclude: /hosts,/vars/insights_signature,/vars/pydata
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldVc3hUbVJqZG5jMU9FUXJhalZ3VGtGUmFXRklVUzhyVGpab2Fs
      cEtkWG9yUXpSQmVEZHlUa1k1YkdSRFQyTldaMU14YmxoQ01UTUtiVkpxYVROSVkxRnhlamwwV1dW
      M2VFMVRkRWx0YW5wWlRYaHJkbUZGZEZaSVdWZzFXRlJJV1VGTWRrcDFkbWhHWTJKcWFFMHJTRXRq
      UVhKd1NEYzJSd293YzBoR1FXOVZWbkkyUzA5RVVXbHhhMDlFYjFJeFN6TXpSMFpEUlRkSlFuZHll
      RE0wVkcxakt6SkJlV1pQTURORGJERnZjVUkwTVhJNE1rUk5NWGxaQ21SWVVXZERPRFIzY1ZWM2Ju
      bzRVR2wxZVVSMWNIVlBXakV6YTJaTE4wRXhWbVZoWWxWRlNIaGlWQ3RCTTI5ek0zQTNha1ZZSzJK
      UVVHSXJOV1JDZDFZS0syTmxkRFpXZG5FMWFrSjZiR1ZpU0VsS01VZHlNaXRUV0RSblNIUm9OV2RL
      WjJKdWFXY3lURXg1ZWpneFdYTlJXVVpsZUZoYVpGRjZTbTh3VkhVNU1BcGtUSFJ3UldWQ2FrMXFV
      RXh0YUROV2FURjVkbXBWWnpWaFpFMW5XWEJwTDFsSGNVZDZVa1pVVlhwR1kyUm9lalJJYldkWk1G
      ZGxOamRzVGpOQlNHZzJDalZxUmxwdllXUndZbk51WW10SGJHMUtSRWhRU0ZCTlJrZEZkVkZFVFdF
      elMxWlZaMjlWVFdOclFreDVWakZoTms5c2JrNURUSFZ0YURJMlExZDRiV3NLYUZCQ1FrNDVTMEZE
      SzNBNVNYcDZObEl3YlN0VWVtWnRPRXBRUW1oQlZrTm5Wa05oUTJoc0wwSkxkM1ZDUmtWUVdEaFhW
      VVJFYlVSdVdrTm9ibXcxYUFwS1NXNVpRMngxUlVsM2VGZFhLM0YxV1RWS05VOUxXRWhTU0dad2NG
      ZERhVEl5YWt3MFMzTmpTRWt3WWxJck5HdHdSbWgxVHpNMk1XRnRVbmRaYzFCS0NrVXlTbFZYT1cx
      dlJrcGxTVlZzVDA1M1IxQTBkVWQzVjFnNGN6ZzNhR1EzTUM4MGExZEdMMmR6YVU0eWFWaFJabEZ2
      WWpGdVQwVXdNMm92YkM5MlYyOEtUVEUwUkZkNlJ6RlRaV05hYXk5TWNrNWlUbmhCYTFCc01YZFZh
      R0p3VkhSS0swWlROa0p1U1hGR1pGZ3dWSEV5VkcxTWRHWkhVR2QwZWtWR1oyTm9WUXBRWTNFMlVr
      a3lUVkUzWXowS1BUaGpaWFlLTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==


  tasks:
    - when:
        - pydata.fixable_by_updating is defined
        - pydata.fixable_by_updating
      name: Update openssh-server package
      yum:
        name: openssh-server
        state: latest

    - when:
        - pydata.ciphers_recomm is defined
        - pydata.ciphers_recomm
      name: Replace Ciphers line in etc/ssh/sshd_config
      lineinfile:
        path: /etc/ssh/sshd_config
        regexp: ^\s*Ciphers
        line: Ciphers {{ ",".join(pydata.ciphers_recomm) }}
        backup: yes

    - when:
        - pydata.macs_recomm is defined
        - pydata.macs_recomm
      name: Replace MACs line in etc/ssh/sshd_config
      lineinfile:
        path: /etc/ssh/sshd_config
        regexp: ^\s*MACs
        line: MACs {{ ",".join(pydata.macs_recomm) }}
        backup: yes

    - name: Restart sshd service
      service:
        name: sshd
        state: restarted


# Privilege Escalation: Systemd unit files with insecure permissions or ownership
# Identifier: (advisor:hardening_systemd_units|SYSTEMD_UNITS_INSECURE,fix)
# Version: b26310c106891875075bf8d16600f16fdec64b20
- name: Fix insecure permissions and ownership of systemd unit files
  hosts: "rhel-kvegh-web25-711.kveghdemo.at"
  become: true
  vars:
    pydata: "{{ insights_report.details['hardening_systemd_units|SYSTEMD_UNITS_INSECURE'] | default('') }}"
    all_dirs: "{{ (pydata.perms_dirs | default([]) + (pydata.owner_dirs) | default([])) | unique }}"
    all_found_files: []
    wrong_perms_exec_or_write_files: []
    wrong_perms_nonroot_group_write_files: []
    wrong_owner_files: []
    insights_signature_exclude: /hosts,/vars/insights_signature,/vars/pydata
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldUYzNRbmx6ZG5jMU9FUXJhalZ3VGtGUmFGTk9aeTg1UmpFMlFV
      SkxaMFkwWTNseFRqSk5ZalozUlRFeGJqSnhhM1pQWlZjM1Iyd0tOUzh6TWprd2JrNUtlRkZpUTNV
      cmMzRnVka1pWVEZsRFYzRmhOMkZUY0c1ek5VWkNhREZ4YmxVNVdrb3lRbFJJWjJ0bmJsY3hTamcz
      Y2xSMmRWRjVOZ3BRZUdOaGNXbFphR2hHZWpGUGRraDZVWGhNVVVsVmMxZHRTMUZCT1RoTGNEazBj
      RzVZV2s0ek9YSm1VbXBHVUhsdU5VczBNRWRwYVhGQlZYbHRXbXcxQ2xOUFVIVlFUbm9yUzFwaE5T
      OWpSbXBtYkhjemFFMHpNRkV6Ym1wYVVHOXJjRUozUVhSSWMzQkNjRWxGWkVZMU5XSTNTMFJoUjB4
      TGJVbHdNM2xITmtVS1RubDROWEpXTDFoWUszSmhUemxZYWxOTFp6bHNTblZxUnpKQlNscERhR1l6
      TVhsS1QxZzFTVlJhYTFkTVRHWkxjRUY2Y0VOR2IwaEVWRmRGVFRscWFncGFjemt2TDFGcmVFMWpW
      SEY2SzNKMFNEaE1TVTkzUzNONVFVWlpiakIzZFdoSlpVSTJMMGRUVVV4Qk1XSnVTbUY2V1hOblJr
      NXNNRk5OY0RSWmFtUnFDbVZHTm1SUmEybDNaamcxSzBsRFJHaDRZazFwTTFkYVJXUnJSR3QyZVdw
      WGRTdENSU3RGVldSbllXZFBNMlZMU1ZKNlEyUndhbGgzVXk5R1pIcFlWa2NLT1hsQk1GUlJOR1pz
      U0U4eU1Vb3dVemhEWWtOdlJuSm1iVzFQYkhCaFJVMTFjVXhLVFcxdmFGVXhZa3BCUVdSdFJGWlpS
      SE5tVkVoTmJXSTNPVmhSUVFwNlRsQkpjVWh0T0U1WllsVXZNeXRUUnpGcVRWaGlNV1ZNYTBadmNU
      Um5UV2hXUVRsU2RtUTBOWEZVWWtOWlIybHRaSEZOVVVGcVZHczFhbkY1TTNaRkNtSjZaSGxSWVdW
      S00yODViVmxTVnpaWFVIUndRMmN2VkRCTVRGRTJOREpTTkdwM1Z6aExPVTFwVjJwRlVtcDVMM1Zw
      TWxKUFZqRlFja2gyVGtwMU5pOEtVekEyTDNabE1qTlBUMDlIUjJSSFRTOU9OV1JSWlVKVlpETjZN
      RlJOYTBjNU5YVkxLM3BuTUhoVFVqQjZjek52UWpOM1JEUjRkR2ROU25vMldYUnBjZ3BtUkV3NGNu
      ZFFabW81YnowS1BXMUlPRzRLTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==

  tasks:
    - block:
        - name: Find all regular files listed in 'perms_dirs' and 'owner_dirs' and store them
          find:
            paths: "{{ all_dirs }}"
            patterns:
              - '*.service'
              - '*.socket'
              - '*.device'
              - '*.mount'
              - '*.automount'
              - '*.swap'
              - '*.target'
              - '*.path'
              - '*.timer'
              - '*.slice'
              - '*.scope'
            file_type: file
            hidden: yes
          register: all_found_regular_files

        - name: Find all symbolic links listed in 'perms_dirs' and 'owner_dirs' and store them
          find:
            paths: "{{ all_dirs }}"
            patterns:
              - '*.service'
              - '*.socket'
              - '*.device'
              - '*.mount'
              - '*.automount'
              - '*.swap'
              - '*.target'
              - '*.path'
              - '*.timer'
              - '*.slice'
              - '*.scope'
            file_type: link
            hidden: yes
          register: all_found_symbolic_links

        - name: Retrieve genuine information of symbolic links
          stat:
            path: "{{ item }}"
            follow: yes
          loop: "{{ all_found_symbolic_links.files | map(attribute='path') | list }}"
          register: stat_files

        - name: Set the final list of files to check
          set_fact:
            all_found_files: "{{ all_found_regular_files.files + stat_files.results | map(attribute='stat') | selectattr('isreg', '==', true) | list }}"
      when: all_dirs|length > 0

    - name: Identify files with insecure permissions or ownership
      set_fact:
        wrong_perms_exec_or_write_files: "{{ (all_found_files | selectattr('xusr', '==', true) | map(attribute='path') | list + all_found_files | selectattr('xgrp', '==', true) | map(attribute='path')\
          \ | list + all_found_files | selectattr('xoth', '==', true) | map(attribute='path') | list + all_found_files | selectattr('woth', '==', true) | map(attribute='path') | list ) | unique }}"
        wrong_perms_nonroot_group_write_files: "{{ all_found_files | selectattr('gr_name', '!=', 'root') | selectattr('wgrp', '==', true) | map(attribute='path') | list }}"
        wrong_owner_files: "{{ all_found_files | selectattr('pw_name', '!=', 'root') | map(attribute='path') | list }}"
      when: all_found_files|length > 0

    - name: Fix "execute" or "others write" permissions of all systemd unit files
      file:
        path: "{{ item }}"
        mode: a-x,o-w
      loop: "{{ wrong_perms_exec_or_write_files }}"
      when: wrong_perms_exec_or_write_files|length > 0

    - name: Fix "group write" permissions of all systemd unit files if the group is other than "root"
      file:
        path: "{{ item }}"
        mode: g-w
      loop: "{{ wrong_perms_nonroot_group_write_files }}"
      when: wrong_perms_nonroot_group_write_files|length > 0

    - name: Fix owner of all systemd unit files
      file:
        path: "{{ item }}"
        owner: root
      loop: "{{ wrong_owner_files }}"
      when: wrong_owner_files|length > 0

    - name: Reload systemd unit files
      systemd:
        daemon_reload: yes
      when: (wrong_perms_exec_or_write_files + wrong_perms_nonroot_group_write_files + wrong_owner_files) | length > 0


# When the Insights Client is not configured properly, it is not able to get recommendations dependent on core collection
# Identifier: (advisor:insights_client_no_core_collection|CORE_COLLECTION_NOT_ENABLE,fix)
# Version: 24837bc195d8d000da96936af6d7883cfa1f79d7
- name: Upgrade the Insights Client to latest or set "core_collect=True"
  hosts: "rhel-kvegh-web25-801.kveghdemo.at"
  become: true
  vars:
    pydata: "{{ insights_report.details['insights_client_no_core_collection|CORE_COLLECTION_NOT_ENABLE'] | default('') }}"

    insights_signature_exclude: /hosts,/vars/insights_signature
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTV05DUVVGQ1EwRkJSMEpSU210MmJIbGtRVUZ2U2tWTmRuYzFPRVFyYWpWd1Rq
      UnlORkF2YWpjMVRUWkVhVVV6UzJWMFZXOVRhRFpoYkZkSlVXc0tZbnBJVjBkRGMydE5ibEZzWkhs
      b1QyNWFXVkZDWlZwVE5YSlRWSGRGVnpSMFptRk5TVzFrWW1GQ2VXUlBhM2hLYjFBclVsZHBNamRO
      UkVkR1ZtWk5NUXBKV1RZd1NUQjFUV1ZGWjFCalVDdDJjVmh3Ym05RE0ySXlNMnRVTm1oMGRHTnBT
      akJSU2xsMVUxQnBUVzFGTWxKYWMwWmxTREJZTW5vNGFUZE1LMHQxQ2pWUFZVMVhMMDFOU0VnMlNU
      VjBlWGhwYWtWd2JXODRaVzVLZW5SSVpreFVjek5rVEhGdmJWZzVaSFZNY1RKUVRWRmlWMUZpY0ZW
      alJESTRUSGRxWXpVS1N5c3dPSHB1Y2pObFVsRTRVbmxVY1U5SFExaDBSSEZxYm5GUVlrWnJUbU5N
      ZEhGcGRIUk1kV3hyV0VOaFpFYzVNeXR4UzB4VGFVNXJOVFZFTURKa1N3cENhMDR6Y2pkUWIzaEhP
      V1J6Wnk5alYybFNRakZuVWpOMVkzVkZWM2xZYzBGS0sxQlZPVkZpVGpsRU5UWnFXVkptY1hrME0x
      SmxiVWRzTDBadFIzTlZDakJJYUU1VlEySkRORVp1YzJGMWIwSm5RMWwyVkhoVlVYbHZWbVJRYjIx
      WWQzaDBUMjFPUjBwc09HVkxlbUpVVnpWdmJWUTNWVFZFZVhkcU9URkRRVEVLZDJVd1ozTkRha0py
      Vm5GQllWQnVVRlpzYjI5VU9EVkZSM0k0T1ZKV1luSnZWMnRpUjNWSlVXUllUWEJMVld0NE5GYzVW
      VGRzVXpVeVVtcFROaTlvVmdwRlYzZzVTV3cxWkM5NE0xcGxSM1ZvUkhSUGIxZEhlalJOYjA4dlNV
      SXpNMnRUYTBGWFRsQkxlV1psUm13eFNrVnllRlJOUzFNemNTdDBiMEZVU210RENsUjVhVzF1TUho
      RlNUaHVUbTQzV2pKcVRXOVNXa1p4WWxGcWJGSnNOMFpOWldKb2VFa3pXRVJ2UjNSRVlsRlRZaTlD
      TW01cFUyaHllV0p5ZG5vMFVXRUtaMGhrV0RCdk1qbGpWMmxSYlRsRWRXWXJORTgwZUVGVWMzSkhU
      eXRxV2xZM1JuSmFVMmx0Y0ZkWE1DOHZjV1Z4TDNWSmQxZFJhbE4zYVRaNVUzQnZUUXBCVHpodFZI
      STNORGcyTlhOc09VWlVieTlvZUFvOU5IUXpaQW90TFMwdExVVk9SQ0JRUjFBZ1UwbEhUa0ZVVlZK
      RkxTMHRMUzBL
  tasks:
    - name: Upgrade insights-client to the latest
      when: pydata is defined and pydata.pkg_up is defined
      yum:
        name: insights-client
        state: latest

    - name: Set "core_collect=True" in insights-client.conf
      when: pydata is defined and pydata.cfg_up is defined
      lineinfile:
        path: /etc/insights-client/insights-client.conf
        regexp: '^core_collect=*'
        line: core_collect=True
        backup: yes
        state: present


# Unsupported kernel version on Intel Purley Platform with Intel Skylake CPU
# Identifier: (advisor:intel_purley_skylake_supportable|INTEL_PURLEY_SKYLAKE_SUPPORTABLE,fix)
# Version: 88d3721bac44b2a2e88cb6e470364af46a2b22d3
- name: Update kernel
  hosts: "rhel-kvegh-web25-711.kveghdemo.at"
  become: true

  vars:
    pydata: "{{ insights_report.details['intel_purley_skylake_supportable|INTEL_PURLEY_SKYLAKE_SUPPORTABLE'] | default('') }}"
    insights_signature_exclude: /hosts,/vars/insights_signature
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldUSlROVmx6ZG5jMU9FUXJhalZ3VGtGUmFqWktaeTh2WkZWSmNX
      NUJZWFIzZFRWc2JETkJiMUpEWmt4cWFGaHZMMnB6VEVGNk1qZ0tlbHBCU0c5NVNuWTFZM013Y0VF
      NVRuazNibEJKYjI0NWN6ZEVhbUZLY1VVeE0xUjFkMmxLZUdNellWUTJha0ZqUzNNeU9XUmhTMEZv
      VFc5RFJreDNWd294TWpOdFVscHpkM0pVZW5ObFJVTTBjek5zTVc1RVJXZGtWVE55VEhGQmR6QmpW
      RGhTWW5KcWRtODVkelYzVVdOU1NHcEZZV3RxVmt0Sk16ZEVXVk4wQ2swNWNtUk1ZVkJOTmxOMUwx
      bElaQzh5TVRkek5sQXJlbUpSV0RodlRteEJLMUpzZVhFMGQwTlNTamgwUjBRMFNtOTVOVFZNUms1
      S05HVlROMVJ5U1djS1FVZHVNbGhYZUcxWk9UVjVlRGsxVmtoSFFWaG1LMjVyYVhKdlFrSXZSelZw
      TkU5WlkzUnRNakpRUjNoemVreE9NRk5KY1N0R1ZYQXZTbE5xVEZNeWJRb3dibk5PV21ZemVqWmtW
      RlZ3TWxsMWNFcHBhakJ1TjNnM2FXdFROSFZ5Vm5GR09VZE1kRVJ3UkVGRFVtWTRkMFJzT1cwMk5G
      Wk1iMlZNZWpWWGJEaFpDalZ0UW5wVFVHSjVSelJFZDJObE9ETkJaMUV6YWpaU2QyVXpTWFZMYjNo
      eFRXVktXa3BZVTNkeFdVZFJOVXhqVjI5RGQwbG1jeXR2YUZsS00yNWpLeThLTVZWMmVWbHBaM05p
      WVZVelVWbzFOME5EUnpkRE0zRlhlRUZOT0hoWWVuWjNkMXBMUlVsWldFZGlabkZsWlVZMmN6ZE1h
      V3hVVURKVFpEaHlMelJ0YkFwQ01FSXhRazAxYlRZM1dVWlNaREZIY1cxQ1duSTFVMHhKVWpacldT
      OVlkbVJOTDNSSk5FeENSeXN2VG5Ock5IaExjMHB1WlhwamVISktWVzV5VFZsVkNtZ3JWRVp0YTBW
      NldESXlXVm95WkRaalNsRmxVVzFyVG05c2NXNXRVWHByZVhGdFYwWlNUM05CYWt0VFRrRm5jVFJx
      TmxGblFTOUNabGwyZWswMlNtRUtTVmszUjNsSGMyUm9TWEI1Ym5kaE5uVjJWbTlMVFdWbWNEUTRN
      M0F4UmxwaFRreE9TVEZ1UkRoU1IyOURWa1Z5YVc1WkwwWlpLMHBDWW14SlJuVkliZ3BEVVRKR1RY
      TjRSVEZyU1QwS1BWUXhRMElLTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==
  tasks:
    - name: Unset the release
      command: subscription-manager release --unset
      when: pydata.cur_lock is defined and pydata.rcm_locks is defined

    - name: Enable base repo
      command: subscription-manager repos --enable="{{ pydata.no_base }}"
      when: pydata.no_base is defined and (pydata.cur_lock is not defined or (pydata.cur_lock is defined and pydata.rcm_locks is defined))

    - name: Enable required repo
      command: subscription-manager repos --enable="{{ item }}"
      when: pydata.cur_lock is defined and pydata.req_repos is defined and pydata.rcm_locks is not defined
      with_items: "{{ pydata.req_repos }}"

    - name: Update kernel to latest version to fix the issue
      yum:
        name: kernel
        state: latest
      register: kernel_update

    - when: kernel_update is changed
      name: set reboot fact
      set_fact:
        insights_needs_reboot: true

    - when: not kernel_update is changed
# The latest kernel is already installed so boot from it.  Sort the installed kernels
# by build time and select the one with the most recent build time
      block:
        - name: Installing kernel package version
          shell: rpm -q kernel --queryformat="%{buildtime}\t%{version}-%{release}.%{arch}\n" | sort -nr | head -1 | cut -f2
          register: latest_kernel
          check_mode: no

        - name: get configured default kernel
          command: /sbin/grubby --default-kernel
          register: default_kernel
          check_mode: no
          changed_when: false

        - when: default_kernel.stdout.split('-', 1)[1] != latest_kernel.stdout
          name: set the default kernel to the latest installed
          command: /sbin/grubby --set-default /boot/vmlinuz-{{ latest_kernel.stdout }}
          register: grub_change
          check_mode: no
          changed_when: grub_change.rc == 0

        - when: grub_change is changed
          name: set reboot fact
          set_fact:
            insights_needs_reboot: true


# Decreased system performance occurs when not running the irqbalance service
# Identifier: (advisor:irqbalance_not_running|IRQBALANCE_NOT_RUNNING_OR_ENABLED_V2,fix)
# Version: 0e74f456ae0c9066bbcc5e39ea2ced90af6a5fd2
- name: Install, enable, start the irqbalance service
  hosts: "rhel-kvegh-web25-741.kveghdemo.at"
  become: true
  vars:
    pydata: "{{ insights_report.details['irqbalance_not_running|IRQBALANCE_NOT_RUNNING_OR_ENABLED_V2'] | default('') }}"

    insights_signature_exclude: /hosts,/vars/insights_signature
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldra3JOSFZqZG5jMU9FUXJhalZ3VGtGUloyOWhRa0ZCYWtOVWJX
      UlZUM1ZyVGpOSmJtdDJORUkzVjFoRlVFMXlXWEEwWmtsdFVWRUtVbWR3VEZkQ1ZrOWFiRE56UWtK
      aU0yZFRSWGczVVVaUE9YUXZRMDlZYURSdGEycG5SRmQzTVVoemNIcDNPV1pyVUhCR1dFaGtSRFU0
      TW1kTlJrOUdVd28wWm1ZNVREUnBha3AyWVhGMU0zY3hUMlExVHk5dlVXeFRkVVIyU2t0VFYxbFJV
      M1JVWlV4TEwyZzBZbTFyVFVaYVlTdHhjMjFwV2pjd2VGaG1WbEpTQ2pSaWJUY3lPVk5qYWt3dlRs
      cGpjMmxMVEdGbmFqUlJOMVJPUW5JM05UY3pVV2R0WVdkRFFVbGhPRk0xTDA1NlVGcHRRVWMxVDJG
      Q1NGVnZaR0ZFY1ZBS1RTOUVNSFYyTDFCcVptVkJRVEV6VnpOb1QyVm1abXc1VkRsVGEwRXdhMDEz
      SzJONk5VSjFjamRZWlRBeU4xSk1abnBLVFZGc1ltc3JWR0psV25Wa2F3cHVkbHBzUm5oYWFIZHBN
      VXBXTkdWV1UySlhMMFJ0ZUZoTmRHTnJRMlIxWnpWeVpGUXJLMVJJYWpoU1VEQlNNRU4wVlZJMFYy
      SkxTbmxRUkRRd1l6ZHVDamw0WWtGeGJtMTFZazUxY1UxdlNFczJaRlpNWmtGT2MyVlNlbTQ0WkZW
      dGRuWm1jMUUyYVhCTWJuQkVabWxKY3paa1dXdFhWMDFXVjI5YWNEVjJSWEVLVGxJcmJVSjNPVE14
      WjNaVVNDdGtRWEZsUlcwek1tWmtSemhoYzJWUVJuaDBMM0l5TVVWUmRVcFdOR1puTkZsM1ZYRTRZ
      MDk2ZWpZMksyTkJSR3RETUFwaWRUUTBja0pOU1VKME5XVnhXWEIzV0hWelIxbDFiRUZDT1dKUmVF
      eG9SWEp3TkVSaE1IZEtkRTQxVjFCTVEzWnhiVGxFU1dvelQzbG5VbGQ0ZGpaWkNqUjZiWFkzUXpa
      NU4wOXBUQ3RPYm1Nck1teHJhMnRvSzFwcFNtSkhkMGx5YWt4RGNtaGhMMG95U1hsWUwxQjVXREow
      ZUV0dmJYTnlPRmswWmtKeFFua0tOM1F2VVVSMlFqTm1ORWhRTjFWb1prWnZZMGMyTURObVRuRllW
      R0p5WTJONmFFZDJMMlpYVldGYWRHeERha2Q1TUVKcVVtZzVja2R3Wm1sNU5pdDBXZ3B6WmpWdFRu
      UTFaRkZPU1QwS1BUZHFMMVlLTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==
  tasks:
    - when: pydata != ''
      block:
        - name: Install the irqbalance package
          yum:
            name: irqbalance
            state: latest
          when: pydata.irqbalance_installed is defined and not pydata.irqbalance_installed

        - name: Enable the irqbalance service
          service:
            name: irqbalance
            enabled: yes
          when: pydata.irqbalance_enabled is defined and not pydata.irqbalance_enabled

        - name: Start the irqbalance service
          service:
            name: irqbalance
            state: started
          when: pydata.irqbalance_running is defined and not pydata.irqbalance_running


# Kernel panic occurs when the qxl driver is being used on the RHEL 8 system due to a bug in the running kernel
# Identifier: (advisor:kernel_panic_kworker_qxl_driver|KERNEL_PANIC_KWORKER_QXL_WARN,fix)
# Version: 88d3721bac44b2a2e88cb6e470364af46a2b22d3
- name: Update the package kernel to the latest version
  hosts: "rhel-kvegh-web25-801.kveghdemo.at"
  become: true
  vars:
    pydata: "{{ insights_report.details['kernel_panic_kworker_qxl_driver|KERNEL_PANIC_KWORKER_QXL_WARN'] | default('') }}"

    insights_signature_exclude: /hosts,/vars/insights_signature
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldUSlROVEZqZG5jMU9FUXJhalZ3VGtGUlowb3ZVUzg0UkZsMU1u
      bGlTR2N5UTNvMVFuVmFiWGd2Y21VeGMyOWlSaXN5UVVWMWJYb0tPVUY2TDNGeU56VnhTVlJYUmpr
      MlVVZEtielZxVGxWR2FuWkJLMm93ZERjclZGcHFiMFpZU3pKM1VYWnRiVTkwYzBFNGEyYzVVVk54
      WW0xRGJFbEVOQXBUYmtKV1ZtSkRjR05zZVdkV2FFMVJXRU5xT0hKME5ITkVTRXQ1UWxCWVJGaE9X
      VmxXUTFCdFYxaEpkVW81Y1hFeVl6UndSakpRT0hwaFRHcFRZVVZqQ2xGMGRIcGFSMUJrT1Vsalky
      NHdjM3BLZDNCRmJYbzViSGxoTVVsMVNWUlVlamRGTml0bUszWTNWM2N6Ym10cWVHRjNaMjlXVEhK
      R1NHUnRkV1pyVTNVS2VubzNiRk5IUjNkMlNDOW9WMmRJWTFoSVJEWldVRzFDTURGSVJVbFFWV3Bz
      VVNzd1pHcEJja3hYWWtGNVZYUjFMM2hGZDJFNVZFTTVjbWQzZFhaVFl3cGlTU3RoYmxORmMybEdj
      bFpWVUZST01qWkVTRVZ5VERGNU9FUlNSVlZ2Vldsa1JUWXJSVVZ0U25kUFVHVnhTams0ZFZWeFRI
      Qm1RMkV4VUc5U2REbDBDbXBwU2s0MFNYcHdkMFZWZFRWc1NuRm1jbUZ2U1RoS1ExSTJSRlV3Y0RC
      elRYUTVabmxIZDFKRGJVZ3JURnBFZFVGeFdVRnZWSEZDYTFJeFdXMTROMGNLZDA5S1ZUWnNhbGh0
      UVVaa2NuRTJaVTVrTVUxUVRHODROM0JUV2tsNGVHaDVkeXN2YVRCa1NFVTFZVFJpVkhWeFpFaDFN
      bGg2VDA5dE9YWTRXQ3RrWkFwMlJHWlVTRFZ1ZDI1aFdsTTRZMmR4YlVaeVpUVkJabXRFTWpCQk5G
      RjJRME1yV1VwT2NrSkphV3RsWlVkb1RqSjVkbXhtYzFSSFkyZDBhMmR4TVVNNUNrUnFiaXN3V1Va
      bVVEVkhiR1UyTlRJdlJsSlZabmcwYTA1VFZXRlJjMFZXUldkWFpISm1TVmd3TVRNdk5tUlZORlJL
      WVVwalNYaE9PVFZzVmpOVGJHSUtObHBpWlZSVWVtSTNSbFE1VkRKNFJraG1PRE5VUTIxUk5UWlNW
      bEVyUm1sd1ptODFRM3BpVGl0WlNFUnBWMFk0ZVdWNE9URlNVazFUYkZWNk9VOUNXUXBCTkRKRlUy
      ZGxaV1F3UlQwS1BWaE1TV0VLTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==
  tasks:
    - name: Unlock RHSM release-set ONLY when cannot fix the issue within the current release-set
      when:
        - pydata.cur_lock is defined
        - pydata.rcm_locks is defined
      command: subscription-manager release --unset

    - name: Enable the RHEL base channel if necessary
      command: subscription-manager repos --enable="{{ pydata.no_base }}"
      when: (pydata.no_base is defined) and ((pydata.cur_lock is not defined) or (pydata.cur_lock is defined and pydata.rcm_locks is defined))

    - name: Enable the required channel "{{ pydata.req_repos[0] }}" to fix in the current release-set
      command: subscription-manager repos --enable="{{ pydata.req_repos[0] }}"
      when:
        - pydata.cur_lock is defined
        - pydata.rcm_locks is not defined
        - pydata.req_repos is defined

    - name: Update the kernel to the latest version to fix the issue
      dnf:
        name: kernel
        state: latest
      register: kernel_update

    - when: kernel_update is changed
      name: set reboot fact
      set_fact:
        insights_needs_reboot: true

    - when: not kernel_update is changed
# The latest kernel is already installed so boot from it.  Sort the installed kernels
# by buildtime and select the one with the most recent build time
      block:
        - name: get latest installed kernel package version
          shell: rpm -q kernel --queryformat="%{buildtime}\t%{version}-%{release}.%{arch}\n" | sort -nr | head -1 | cut -f2
          register: latest_kernel
          check_mode: no

        - name: get configured default kernel
          command: /sbin/grubby --default-kernel
          register: default_kernel
          check_mode: no
          changed_when: false

        - when: default_kernel.stdout.split('-', 1)[1] != latest_kernel.stdout
          name: set the default kernel to the latest installed
          command: /sbin/grubby --set-default /boot/vmlinuz-{{ latest_kernel.stdout }}
          register: grub_change
          check_mode: no
          changed_when: grub_change.rc == 0

        - when: grub_change is changed
          name: set reboot fact
          set_fact:
            insights_needs_reboot: true


# Kernel panic occurs when a network interface with an IPv6 local route is unregistered
# Identifier: (advisor:network_device_unregister_issue|NETWORK_DEVICE_UNREGISTER_ISSUE,package_update)
# Version: 31c306a860e17c53dda94991adb03a293b6dc052
- name: Update the package kernel
  hosts: "rhel-kvegh-web25-741.kveghdemo.at"
  become: true
  vars:
    kernel_pkg: "{{ 'kernel-rt' if 'rt' in ansible_kernel else 'kernel' }}"
    pydata: "{{ insights_report.details['network_device_unregister_issue|NETWORK_DEVICE_UNREGISTER_ISSUE'] | default('') }}"

    insights_signature_exclude: /hosts,/vars/insights_signature
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldra3ZTMDg0ZG5jMU9FUXJhalZ3VGtGUlowRnZkeTh2WkhKMGN6
      SlRhRXR1TDFwVGQyNW1USGRIY25GSWJtOUhNRzQ1WkRsTlVWUUtPWFl3Wm1kMk4wZDRiemc0YkVk
      RVJrZzJXbnA0VFRad2RuRjJXSEVyVkhKclFrVjRaSEpvWjBWVlEwZGFXVEpFVlVJNE9UaEpNbEI1
      YWpJcmNFUnBNd3BaYUU1R2JEUnZZbU5zWjFaU2IwOUJZMVpXWjB4bmJtaE5VemhxV0dRMWIxSkdW
      bUZSVHpkcFFTOVNUVWxsUlhOV09FaDFXRTEyVUhaNFZra3dabFpPQ21wd05IbE5hVGhhUnpsREwz
      bHpNa1J0Ym1OWmNqTTFPVFpYV2pJM1pISlljR3d2VmtaRk5UQTFiM1YwYm5wdlYwbENSbGR4YTBG
      SGJHTkVZMmQ1SzJNS1RteHRiM1l6TTBwWEsxaEZUMWt3Y1RKS2J6bFFkMkpDZW13eWRuQldjMlJv
      WlRJeGVWZG1RMlF3Tms1NUsyVlBOMk5sYVdaRlNuZGpVR1ZwWXpScmNBcE9aelZwZWpaME1UUlRT
      R2RTYVd0cFZsRjVjRXRtT0UxV1FVOTJVa3cyWlRsTk5qZFRSVlpKUTJvdmFHSnpZM1ZHTmpscGEy
      NUdjWGhHVFZoQlVYTkdDbk16Y2psS2N6UmhUbmhtVjFGV2RXdGFWemhMVkhFd05XSnlWWFJQZURO
      bVZEUXZNa3h1U0ZkMU5VWkRlVEZWVmtrelVpOUNObk00ZWxsYU1XNVZkWGNLUVdOU2FVbHhXalJ1
      WkhONVFVRjZZWEkwU2xreWVYTldVR3NyZG5aTlUyRllhRmwwVlROR01DczVkMFF3WmtWT0swSXhT
      WGhuWjJKaVJHRTBVMkpGWWdwWk5FcHBTbmgxVkRaaFdVWmtTWFF2V0haSk5FOTVTbmxLY201amEy
      ZE1NV1ZzY25acFRUVXJTak13YnpWeE5XOUVibU50WjJoUE1rVlNTbXd4YnpRekNsWktkR1JsWkdo
      NloyRkZUa0ZrV0dkUE5VdG1ZMjh5SzNSU1ZuWndOR1JaVEhaWlp6bFRaWE5aVDA5a2JuWTNkREpJ
      TjNScVJVbHBRV1p5WldGVlNFZ0tiVVlyYjNWSloxUnBiV1p0UzJOUU0yNXFVWHA1YjJReVpuaGtZ
      bVJZYUVzclFuUkNObWhEVFU4d1IzRk5VWFpxUmxaWGVUSkZlVkk1Y2xkNFkzZzRhZ3AyTUZSa1JG
      RlJSVUprVVQwS1BYRkxjMWdLTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==
  tasks:
    - when: pydata != ''
      block:
        - name: Unlock RHSM release-set ONLY when cannot fix the issue within the current release-set
          when:
            - pydata.cur_lock is defined
            - pydata.rcm_locks is defined
          command: subscription-manager release --unset

        - name: Enable the RHEL base channel if necessary
          command: subscription-manager repos --enable="{{ pydata.no_base }}"
          when: (pydata.no_base is defined) and ((pydata.cur_lock is not defined) or (pydata.cur_lock is defined and pydata.rcm_locks is defined))

        - name: Enable the required channel "{{ pydata.req_repos[0] }}" to fix in the current release-set
          command: subscription-manager repos --enable="{{ pydata.req_repos[0] }}"
          when:
            - pydata.cur_lock is defined
            - pydata.rcm_locks is not defined
            - pydata.req_repos is defined

        - name: Update the package
          yum:
            name: "{{ pydata.pkg_name }}"
            state: latest
          when: pydata.pkg_name != "kernel"

        - when: pydata.pkg_name == "kernel"
          block:
            - name: Clear and update repos
              command: yum clean all
              register: yum_clear
              changed_when: '"Cleaning up everything" in yum_clear.stdout'

            - name: Update kernel
              yum:
                name: "{{ kernel_pkg }}"
                state: latest
              register: yum

            - when: yum is changed
              name: set reboot fact
              set_fact:
                insights_needs_reboot: true

            - when: not yum is changed
              block:
                - name: get latest installed {{ kernel_pkg }} package version
                  shell: rpm -q {{ kernel_pkg }} --queryformat="%{buildtime}\t%{version}-%{release}.%{arch}\n" | sort -nr | head -1 | cut -f2
                  register: latest_kernel
                  check_mode: no

                - name: get configured default kernel
                  command: /sbin/grubby --default-kernel
                  register: default_kernel
                  check_mode: no
                  changed_when: false

                - when: default_kernel.stdout.split('-', 1)[1] != latest_kernel.stdout
                  name: set the default kernel to the latest installed
                  command: /sbin/grubby --set-default /boot/vmlinuz-{{ latest_kernel.stdout }}
                  register: grub_change
                  check_mode: no
                  changed_when: grub_change.rc == 0

                - when: grub_change is changed
                  name: set reboot fact
                  set_fact:
                    insights_needs_reboot: true


# Kernel panic occurs when ip6_route_dev_notify function receives an empty pointer from snmp6_alloc_dev while unregistering IPv6 enabled network device due to a known bug in the kernel
# Identifier: (advisor:network_ipv6_dev_route_crash|NETWORK_IPV6_DEV_ROUTE_CRASH,kernel_update)
# Version: 88d3721bac44b2a2e88cb6e470364af46a2b22d3
- name: Update the package kernel
  hosts: "rhel-kvegh-web25-741.kveghdemo.at"
  become: true
  vars:
    kernel_pkg: "{{ 'kernel-rt' if 'rt' in ansible_kernel else 'kernel' }}"
    pydata: "{{ insights_report.details['network_ipv6_dev_route_crash|NETWORK_IPV6_DEV_ROUTE_CRASH'] | default('') }}"

    insights_signature_exclude: /hosts,/vars/insights_signature
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldUSlRNbGROZG5jMU9FUXJhalZ3VGtGUmFYZE5RUzg1UldsMVNs
      UXJVMGhXWTFaelNEZEJhbXRJY0ZaV1EzVndjall5VW5oTWVISUtSWGd4ZHpsRWNFaG5NV0V6UjAx
      TllXMUVWVk5tU0haVWVGTTNXblozWlhOcWFIRTVVVzF5TmpoWFlrOHpibTlHY2tadFpYQlFZUzg0
      YjJveWFuZDFUUXBDVDA5d05EQjBPRkJTWWl0R01UWndSR2czZGtocVl5OTVkM2w2TTJaMGVHRnBa
      MHN6VVZsM05WQldOMWwzY0ZWM2F6QTRTVlJKV2k5dWREWlhWR2hvQ25Vd2RHbG5VQzlDUW5kVVZV
      ZG5lR2xRUjA5TFNpdEhiWFV3Wkc1VFMwaG9PWFpIU2psSU4wbDJUa1U1YjI1NldFdDJPWEZrVkM5
      R1VqQlJUakJxUmxFS01IUlpMMjFGYzNaa1ZtVjNjMk5OU1RGNFEwWlRhamN6UjNOaksyTmxlVlZx
      VGsxV1ZWTmFTbUpDYzJSeVMzaDBjaXRQZEZkeUsxbElZMkp1TDJORWNncFNhMmw0VUhKek4weFNV
      MjlyYURacFVrUklXVWM0TURsRGRWTkpXVlZ1SzNoUFZqVkZVbE00YWt4Q1JYTTBOazVHWkV4bFdI
      aFdTVVpUZDJRMk4ydE5Dbk5yUTBSVmRrc3JXamRHYkVSelRXUXJMemhsUTJOc1JrbHBUQzkxVlM5
      VFFqRlFTVXhNU25ONVZsWjFVMnRrT1V3d2QycEtRV1JFVDJWbmFVcENhVTRLWkRkNFpGSk5SM1pp
      VUhsUmREQnhhV1ZDWlZKVVVXWjVWSGxGVG5VcmQzZDRhV2hIVTIxQ0wzZE1PVUozY2xGS05HTm9T
      REp6YjBWQkwyRkJlbXMzUWdwYWNFTmtVa1JxVm5acVpIWktaV0l5WlhRMWNXYzFTems1YmxNeVNH
      TldiV2Q1YW01VVkwWndZVk5WT0ZSdE9ETkxPRkZJUlhsWmRuWXdXR1poY21ORkNqVmhSWE5OTm5O
      WU9WWXJaR3N5VWt0R2RVZFZXV1YzVUdwbWNXeENRbU40ZDJGYVlsQkhZMlpqZFVNMU9XNHdaVVZZ
      Y0d4S1ozTjBiMHBEYzJwcGIxQUtURXRvYUc5T09WRkRPWGRQWW5aVWRXaDFXVkE1VTIxaVQzZzRW
      VFJEWTFSamFEWjVXRGM1Ukd4TFpubElaVWwwYjJndmVUZDFTWFIwUmk5aVIyeFdkd3BUWlVKT1Vs
      SmlNR2s0WnowS1BURlVRVTBLTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==
  tasks:
    - name: Unlock RHSM release-set ONLY when cannot fix the issue within the current release-set
      when:
        - pydata.cur_lock is defined
        - pydata.rcm_locks is defined
      command: subscription-manager release --unset

    - name: Enable the RHEL base channel if necessary
      command: subscription-manager repos --enable="{{ pydata.no_base }}"
      when: (pydata.no_base is defined) and ((pydata.cur_lock is not defined) or (pydata.cur_lock is defined and pydata.rcm_locks is defined))

    - name: Enable the required channel "{{ pydata.req_repos[0] }}" to fix in the current release-set
      command: subscription-manager repos --enable="{{ pydata.req_repos[0] }}"
      when:
        - pydata.cur_lock is defined
        - pydata.rcm_locks is not defined
        - pydata.req_repos is defined

    - name: Update the package
      yum:
        name: "{{ pydata.pkg_name }}"
        state: latest
      when: pydata.pkg_name != "kernel"

    - when: pydata.pkg_name == "kernel"
      block:
        - name: Clear and update repos
          command: yum clean all
          register: yum_clear
          changed_when: '"Cleaning up everything" in yum_clear.stdout'

        - name: Update kernel
          yum:
            name: "{{ kernel_pkg }}"
            state: latest
          register: yum

        - when: yum is changed
          name: set reboot fact
          set_fact:
            insights_needs_reboot: true

        - when: not yum is changed
          block:
            - name: get latest installed {{ kernel_pkg }} package version
              shell: rpm -q {{ kernel_pkg }} --queryformat="%{buildtime}\t%{version}-%{release}.%{arch}\n" | sort -nr | head -1 | cut -f2
              register: latest_kernel
              check_mode: no

            - name: get configured default kernel
              command: /sbin/grubby --default-kernel
              register: default_kernel
              check_mode: no
              changed_when: false

            - when: default_kernel.stdout.split('-', 1)[1] != latest_kernel.stdout
              name: set the default kernel to the latest installed
              command: /sbin/grubby --set-default /boot/vmlinuz-{{ latest_kernel.stdout }}
              register: grub_change
              check_mode: no
              changed_when: grub_change.rc == 0

            - when: grub_change is changed
              name: set reboot fact
              set_fact:
                insights_needs_reboot: true


# Code injection risk or wrong pid altering when rhnsd daemon file rhnsd.pid is world writable, due to a bug in rhnsd
# Identifier: (advisor:rhnsd_pid_world_write|RHNSD_PID_WORLD_WRITABLE,fix)
# Version: 1a2bb5b8af14dcc80f3c261658d115ea7fe22272
- name: Update rhnsd package
  hosts: "rhel-kvegh-web25-741.kveghdemo.at"
  become: true

  vars:
    insights_signature_exclude: /hosts,/vars/insights_signature
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldVc3llRUpOZG5jMU9FUXJhalZ3VGtGUloyWnlkeTh2VVVacGQw
      bFdWMDFPWjAxUWFXeFNkWE41VGt0a1VESjBjV3hSWnk5VVdIY0tNek0yUWpKVFFqQlNTMDF4T1VK
      SU9WYzNVVGQzUzBKelYyaFZkWEpKYjBsYVZHTjRlbWRYTkVzcmRERnpjWFUyYXl0aFpqbG9UVXhv
      Y0d0dVNFUkpOUXBLWWpBM1ZITjRkSGh0TUdSbmNGVlZiamR3SzBJMlRFRnlVemg1Wm01RFdpdG5j
      RU4xT0dsaGNGVnZkSHBOTDBzMWRVNVpkV3M0U3pZNFptZE5lbkZMQ25GNlEwTXpiV0pSUjA1NlJH
      UTFjemhWTmpGWVlVMHhjSFpPY1hSbE5WTXJOMDlOWlVKYVJFeHhXVTFYWm1ZeWJGb3pXVXMzVFZk
      SFkxUmFWREJDYVhRS1VYbFRNWFF4VWxVNE5VNVNhazlDVTBobU9XWmpkRTh2WlVscGFHWktiRVJv
      U0RkUWRGWnRNV05uWWpaRmJIZHZkRkJSU0hkek9EbHJOekZ4T1hkUlJ3cERZVFYxZG5nclVWTlFj
      VmxrUlROSldsWm1XbXRMYlhWTmJYWllOMHhUVVhNMmRHcGhSWGRHSzFWdGNIUmhXalk0YkZkWGEy
      TkNOMU5TUWpkVk5uVTRDbGxHYTNsSWRWQnZSWEJxV0V4dWNXYzVZMEZsVWt0M2FWazBRalpsYlZs
      aVdXWjFlV3N2UVVkYVRYaHJjUzl3TldRMVdXUnJZa2RtVmtneVNsRXpURElLU1VzclJUWkVaakJI
      VWtwSmRtcGlLM055V1ZsWWVYUktaRzFDZVhGdk5VOVdjbkozWjBSV1F6bFJMM1pvVDB0V1YwNDBi
      V2hNYkUxMmFHSjFlRkV3VndvNFNXTXpPVGRvUjJkeGQzVlNaemg1Wm5oMmNtNTFPV3AxVUhCV1My
      TXdNeTlzVlZkNlpHOUZWVWRMVjNBMVZrUlBjemRtTm1NMldrWk9TV2M0VjFWM0NtODBibGRMTTIw
      cldsa3pNMDlOTURWcVp6aDBhazUwWm1Wakx6ZDJWSFp6TW1SeU5rUkJhWFJOYWtGbFpqVnBUWGsz
      VEdobmRIWnZlbmhpUkcxUWJuY0tjSHAxWjFacE5VZFBRMVYwWXpJeFRHMURjM1JFVDAxaU9TOUJh
      blp1Um5KNlpsbEJTVkpPTW1sRE9UUmxhbWRuZGpkUU1EZHFWVTF6WW5Gd05GQnBOZ3BHTW05clpE
      WkJlRXQ2U1QwS1BVOHdlVmNLTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==
  tasks:
    - when: ansible_distribution_major_version == '7'
      block:

        - name: Update rhnsd package
          yum:
            name:
              - rhnsd
            state: latest


# Reboots a system if any of the preceeding plays sets the 'insights_needs_reboot' variable to true.
# The variable can be overridden to suppress this behavior.
- name: Reboot system (if applicable)
  hosts: "rhel-kvegh-web25-711.kveghdemo.at,rhel-kvegh-web25-741.kveghdemo.at,rhel-kvegh-web25-801.kveghdemo.at"
  become: true
  gather_facts: false
  vars:
    insights_signature_exclude: /hosts,/vars/insights_signature
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldVaHBRMVk0ZG5jMU9FUXJhalZ3VGtGUmFrMUVRa0ZCYTJOeE1W
      WlhVbEF3VUVoMGRIRjBWMGt4UkZSdU4zcE1kbFUyU0hKd2QxSUtUbkJ3Um5SWGJWRktiM2xxYm1w
      bE5XUmFSemMxUTNCU1kzZGFPRU5XVW5sRlRVRXpVREExZW1Kc1UzSnFWbTUxVW5oNlpVeG1SbTFy
      YW1SRVJWcHdjZ3ByWTJ0d2FFazJSVUpIYWtJemEyaGFUalJ5YTNwUWRWQm1PR1pMUVdsSE1ESmxk
      SGhXVFZWV01tZHRkV3c0UjBJMmRIcEpkRk5uVFRGQlFYQkdORTFRQ2s1NFRDOUpUMlY2ZFdRMGFt
      VlFaV05KZWpGS1dtMTVkVGgzWTNoVFZqWkpTbTVPU1VGSGVHYzVWRUpVYzNNMFEwbHVaVlZXY0RG
      VWRrUlFPUzlHVXk4S2VGaFlaMFphWlM5VlZuQjBaRzA1ZDJkbmRVOXRiR2hvWVZCTVZHNU5Tbkoy
      UVRsV2FVUnZRVzV2WWt0b1VIbEtZMHBSYjJOTFdrRlRjVTF6ZWs1VWNncHVNek5JYlRoUk9IQnRW
      VTFLYldobU9VRnZkM2x4VW5GWVVHeHpXVGwzT0UxRU1WQkZjR3htY2pJeVlYTjFMMHhvYjNGNlIz
      TmtOMUUxTTJwdFMyNXBDaXM1Y0VjeWEzVkNSVXhpVVhoblRHcERiVlZsUzFCdmJuaFhjM0JuVFZs
      M2VYQjFaVFJvYnl0dmFsZG5WRGR2ZG1GbFRFNVRTMkV2UkZOS2JEWldRaThLZEd4YUwxUXJPRFZr
      Ym5ZclNWb3phbEJTZFM5bVpuZFBkVVpVV2xoNmVGTkJUalZSV1M5ak15c3hhbUZSTDBKeFdYTmhi
      M2RpUkZreGRXUXZVeXRsYVFwa2FEa3JWRkV5TlVKa1NYa3hibGh3ZWpoV1JHbHpjbEp3Y0VrNWFs
      SldWakkwTVVVelRVWkhka1ZaTm1aVFYzSlZWMWMzY0RKbFpUbGphelpOVlUweUNrNUZjRXBLWm5G
      UFNFdHBjRXRPZVRKdVFVRTJURmcxTHpNeGFWSk9VSEZZVXpKRVdqSlpkbVZTUTJOMmVDOHZPVTlo
      UzFWd1FsZElZVmxYYW5STU4wWUtSWFJWVEZGeFZESkJPVTF3WjFSU1RtOU5WbEZ4Y1haQ01GUlBP
      WE00TmxoTmRuUkdRa1IzYW5SbWIxSm9NRnBEYlUwME1FRlhRMHBxT0RKNlduTlRZUXBCYXpkUEsy
      UkpkMFl5VVQwS1BWcEtiallLTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==
  tasks:
    - when:
        - insights_needs_reboot is defined
        - insights_needs_reboot
      block:
        - name: Reboot system
          shell: sleep 2 && shutdown -r now "Ansible triggered reboot"
          async: 1
          poll: 0
          ignore_errors: true

        - name: Wait for system to boot up
          local_action:
            module: wait_for
            host: "{{ hostvars[inventory_hostname]['ansible_host'] | default(hostvars[inventory_hostname]['ansible_ssh_host'], true) | default(inventory_hostname, true) }}"
            port: "{{ hostvars[inventory_hostname]['ansible_port'] | default(hostvars[inventory_hostname]['ansible_ssh_port'], true) | default('22', true) }}"
            delay: 15
            search_regex: OpenSSH
            timeout: 300
          become: false

- name: run insights
  hosts: "rhel-kvegh-web25-711.kveghdemo.at,rhel-kvegh-web25-741.kveghdemo.at,rhel-kvegh-web25-801.kveghdemo.at"
  become: true
  gather_facts: false
  vars:
    insights_signature_exclude: /hosts,/vars/insights_signature
    insights_signature: !!binary |
      TFMwdExTMUNSVWRKVGlCUVIxQWdVMGxIVGtGVVZWSkZMUzB0TFMwS1ZtVnljMmx2YmpvZ1IyNTFV
      RWNnZGpFS0NtbFJTVlpCZDFWQldVaHBRaXR6ZG5jMU9FUXJhalZ3VGtGUmFXdDRaeTh2WmtaRFoz
      QXlTblIxVEd0UU5qQnNTa3BZYm1GU1JGTjVjVVYwU0ZSNlRGY0tOVlZSVlc5MWEyUmpVRFJVUlZn
      d01EaDFhRkJHUzFaSmVrdFVTR2RsYTFOaU1UUXlkMjlQYm5sR2VUUnpRbEJrZEZoaGREVlliWEp0
      VGxsR1EwaEVWZ28xYVhSdlNrcDBPVzg1UWtkQlJVaDVZMFJ3SzBoNVNqWXphM0paZVRGUk1rOXVU
      azF3VjJaSmNtYzJUakJXVTJoa1JtVk1lR0ppTjBaMlpFaEpjbFo2Q2pJNGFrdHhOemx1Tm13eUx6
      aDZZVkJSTDFkWVZIWkNaMDVhUkVWTFJ6TmhSSFl3WVRkbWIyUnlPRWhEZGxseE5tNUhNRkZOY1RO
      U1ZFOXBkbFZtTTFnS1JuQnlhVTh2TDNKSlRDOVlSelE1TTA1NGFWSjBRakVyZEhSUk0wZHNhM1ZE
      ZFVwck1EQkdaREp0ZDNZNFprRnZaR2xUUW5aelQydEpZekZyV25adFN3cEJjR3BEY1ZKMWVHaExU
      MDgzYWxZM1FYSnRTV0p6TkhobVJrUkJVMkZaV2t4R01VMHZhME42ZWs1d1MwTjFhbE5hVUUxRlVt
      WlhhV2RHVGpGMWRqRjNDalpQSzB0b1pTdFJVRU5hUm5CV1kwVndSbTFSTVdwcWFrOVFPV2haSzNW
      alZWSnhSVEkyTlhGTWRuWnFSWE4wUW5WQk4xQkZNRVZ3UkRsaU5VaFZSM1lLTkZKemJXc3pNbFpC
      Vnl0WE5IWk1VRWQwZG1sQ00wSXpUbE0wZUhCdVIzSmlObGs1Y1cwNFZuVTJSRUZIV2xOYWRsbFlk
      bWQwTm1WR2N6RTVTVFZZUWdvMGVtcFVSRUlyTW1sT2NrcE9jM2d5YURoU1VGVnJMMmhZUzFKMGEy
      WnZZMlpKZVRkcGNWY3hiMGRsTlZSMmFqTTFSbXRqUld0YU9VRnpSMjl6WXpWMENuUlZkVlZJWWpS
      ME5EVTFSSE5EWlZWc1ZEZFNOakJDTTB4d1Z6TmlTRTF0YzFCMEx6RktNRFEwYm1KS2RFTkhUM1Jy
      UVVWWVRsVTJlbGxUTDNBMFFqSUtaSFYxY2tZdlNHUnFWWFJNVDNSdlNFTnlZVWd2WkZwaFRVNTZk
      MVZpZUc1VFZXUkdZU3R6TTBaNFJHczFVVkU0VVRaMVVucFpRbWw0WkcxeWREZGpUQXBKYTA1NlEy
      aHBRMDlrY3owS1BVMVZOMk1LTFMwdExTMUZUa1FnVUVkUUlGTkpSMDVCVkZWU1JTMHRMUzB0Q2c9
      PQ==
  tasks:
    - name: run insights
      command: insights-client
      changed_when: false